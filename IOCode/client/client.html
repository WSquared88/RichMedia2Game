<!DOCTYPE html>
<html lang="en">
<head>
    <script src="/socket.io/socket.io.js"></script>
	<!-- <link rel='stylesheet', href='assets/style.css' > -->
	<style>
	
	*{
		color: black;
		font-size: 12px;
		background-color: #CAD7DB;
	}

	#title
	{
		padding: 1em;
		color: #27AAD6;
		background-color: #E8D9DF;
		text-align: center;
		border: solid;
		font-size: 50px;
	}

	body
	{
		background-color: lightgrey;
		margin: auto;
		overflow: hidden;
	}

	canvas
	{
		width: 100%;
		background-color: white;
		font-family: "Arial";
		font-size: 2em;
	}
	</style>
    <script>
        "use strict";
    
        var canvas;
        var ctx;
        var socket;
		var cardsInHand = {};
		var numCardsInOpponentsHand = 0;
		var points = 0;
		var animationID;
		var wIsPressed = false;
		var aIsPressed = false;
		var sIsPressed = false;
		var dIsPressed = false;

        var player = {
            id: 0,
			time: new Date().getTime(),
			color: "rgba("+Math.floor(Math.random()*255)+", "+Math.floor(Math.random()*255)+", "+Math.floor(Math.random()*255)+", 1)",
			points: 0
        };
		
		function redraw()
		{
			//ctx.clearRect(0,0,canvas.width, canvas.height);
			//var key = Object.keys(squares);
			//var html = "";
			//
			//ctx.fillStyle = flag.color;
			//ctx.beginPath();
			//ctx.arc(flag.x, flag.y, flag.radius, 0, 2*Math.PI);
			//ctx.fill();
			//ctx.closePath();
			//
			//console.log("key length"+key.length);
			//for(var i = 0;i<key.length;i++)
			//{
			//	console.log("square "+i);
			//	ctx.fillStyle = squares[key[i]].color;
			//	ctx.fillRect(squares[key[i]].x, squares[key[i]].y, squares[key[i]].width, squares[key[i]].height);
			//	html += "Color: "+squares[key[i]].color+" Score: " + allPoints[squares[key[i]].id] + "\n";
			//}
			//
			//ctx.fillStyle = "black";
			//ctx.font = "20px Arial";
			//ctx.fillText("Score: " + square.points, 10, 30);
		}
		
		function update()
		{
			animationID = requestAnimationFrame(update);
			if(wIsPressed)
			{
				//square.y -= 3;
				console.log("player id " + player.id);
				socket.emit("nextTurn", player);
			}
			
			if(aIsPressed)
			{
				//square.x -= 3;
			}
			
			if(sIsPressed)
			{
				//square.y += 3;
			}
			
			if(dIsPressed)
			{
				//square.x += 3;
			}
			
			sendPos();
			/*if(wIsPressed || aIsPressed || sIsPressed || dIsPressed)
			{
				sendPos();
			}*/
		}
		
		function sendPos()
		{
			var message = 
			{
				message: "",
				id: player.id,
				data: player,
				time: new Date().getTime()
			};
			
			socket.emit("updatePos", message);
		}
        
        function init() 
		{
            canvas = document.querySelector("#canvas");
            ctx = canvas.getContext("2d");
			
			ctx.canvas.width = window.innerWidth;
			ctx.canvas.height = window.innerHeight;
			
			ctx.font = "20px Arial";
			
			socket = io.connect();
			socket.on("connect", function()
			{
				var message = 
				{
					message: "",
					data: player
				};
				
				socket.emit("init", message);
			});
			
			socket.on("connected", function(message)
			{
				console.dir("Connected to server ");
				player.id = message.id;
				console.dir(message);
			});
			
			socket.on("startTurn", function()
			{
				console.log("Your turn has started");
			});
			
			socket.on("endTurn", function()
			{
				console.log("Your turn has ended");
			});
			
			socket.on("exception", function(message)
			{
				console.log(message.data);
			});
			
			socket.on("log", function(message)
			{
				console.log(message.data);
			});
			
			document.onkeydown = function(e)
			{
				var charCode = String.fromCharCode(e.keyCode);
				if(charCode == "W")
				{
					wIsPressed = true;
				}
				
				if(charCode == "A")
				{
					aIsPressed = true;
				}
				
				if(charCode == "S")
				{
					sIsPressed = true;
				}
				
				if(charCode == "D")
				{
					dIsPressed = true;
				}
			};
			
			document.onkeyup = function(e)
			{
				var charCode = String.fromCharCode(e.keyCode);
				if(charCode == "W")
				{
					wIsPressed = false;
				}
				
				if(charCode == "A")
				{
					aIsPressed = false;
				}
				
				if(charCode == "S")
				{
					sIsPressed = false;
				}
				
				if(charCode == "D")
				{
					dIsPressed = false;
				}
			};
			
			requestAnimationFrame(update);
        }

    window.onload = init;
	window.onresize = function()
	{
		ctx.canvas.width = window.innerWidth;
		ctx.canvas.height = window.innerHeight;
		redraw();
	};
    </script>
</head>
<body>
	<h1 id = "title" >Springs of Albion</h1>
    <canvas id="canvas">Please use an HTML 5 browser</canvas>
</body>
</html>